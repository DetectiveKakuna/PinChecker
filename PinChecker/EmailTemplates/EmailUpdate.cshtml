@using PinChecker.Models.Enums
@model PinChecker.Models.EmailUpdateModel

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pin Shop Updates</title>
</head>
<body style="background-color: #FFC2D1; color: #4A4A4A; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; line-height: 1.6; margin: 0; padding: 0;">
    <!-- Gmail spacer hack -->
    <div style="display: none; max-height: 0px; overflow: hidden;">
        &nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;
    </div>

    <!-- Background wrapper with pattern -->
    <table width="100%" cellpadding="0" cellspacing="0" border="0" bgcolor="#FFC2D1"
           style="background-color: #FFC2D1;
               background-image: radial-gradient(circle, rgba(255,255,255,0.3) 2px, transparent 2px),
                                 radial-gradient(circle, rgba(255,255,255,0.3) 1px, transparent 1px);
               background-size: 30px 30px, 15px 15px;
               background-position: 0 0, 15px 15px;
               min-width: 100%;">
        <tr>
            <td align="center" valign="top" style="padding: 15px 0;">
                <!-- Main container -->
                <div style="background-color: #F0F0F0; border-radius: 15px; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); box-sizing: border-box; margin: 0 auto; max-width: 650px; padding: 0; width: 100%; overflow: hidden; border: 4px solid white;">

                    <!-- Header banner - FIXED: Added overflow:hidden and removed bottom positioning -->
                    <div style="background: linear-gradient(135deg, #FFC2D1 0%, #CBC3E3 50%, #89CFF0 100%); padding: 20px 0 20px; text-align: center; position: relative; border-bottom: 5px solid white; overflow: hidden;">
                        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: repeating-linear-gradient(45deg, rgba(255,255,255,0.1), rgba(255,255,255,0.1) 10px, transparent 10px, transparent 20px);"></div>
                        <div style="position: relative; z-index: 1;">
                            <h1 style="color: #43357A; display: inline-block; font-family: 'Century Gothic', 'Futura', sans-serif; font-size: 32px; font-weight: bold; letter-spacing: 2px; text-shadow: 2px 2px 0px rgba(255,255,255,0.5), -1px -1px 0px rgba(0,0,0,0.1); margin: 0;">
                                @Model.EmailTitle
                            </h1>
                            <div style="margin-top: 8px; font-size: 14px; color: #6B4984; font-style: italic;">
                                @Model.EmailSubtitle
                            </div>
                        </div>

                        <div style="position: absolute; bottom: 0; left: 0; width: 100%; height: 6px; z-index: 2;
                             background: repeating-linear-gradient(90deg, #FFC2D1, #CBC3E3 20px, #89CFF0 40px, #CBC3E3 60px, #FFC2D1 80px);"></div>
                    </div>

                    @foreach (var shopChanges in Model.Changes)
                    {
                        <div style="margin: 25px 15px; position: relative;">
                            <div style="position: absolute; top: -5px; right: -5px; bottom: -5px; left: -5px; background: linear-gradient(135deg, #FFC2D1 0%, #CBC3E3 50%, #89CFF0 100%); border-radius: 60px; z-index: 0;"></div>

                            <!-- Main store name container - FIXED: Added display:flex for centering -->
                            <div style="position: relative; background-color: #CBC3E3; padding: 15px; border-radius: 50px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.15); overflow: hidden; border: 3px solid white; z-index: 1; display: flex; justify-content: center; align-items: center;">
                                <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;
                                         background: radial-gradient(circle at 20% 50%, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 50%),
                                                   radial-gradient(circle at 80% 50%, rgba(255,255,255,0.8) 0%, rgba(255,255,255,0) 50%);"></div>

                                <div style="position: absolute; top: 15%; left: 10%; width: 6px; height: 6px; border-radius: 50%; background-color: white; box-shadow: 0 0 10px 2px rgba(255,255,255,0.8);"></div>
                                <div style="position: absolute; top: 65%; left: 80%; width: 4px; height: 4px; border-radius: 50%; background-color: white; box-shadow: 0 0 8px 2px rgba(255,255,255,0.8);"></div>
                                <div style="position: absolute; top: 35%; left: 85%; width: 5px; height: 5px; border-radius: 50%; background-color: white; box-shadow: 0 0 10px 2px rgba(255,255,255,0.8);"></div>
                                <div style="position: absolute; top: 75%; left: 25%; width: 5px; height: 5px; border-radius: 50%; background-color: white; box-shadow: 0 0 10px 2px rgba(255,255,255,0.8);"></div>

                                <!-- FIXED: Made sure text is properly centered -->
                                <h2 style="color: #43357A; font-family: 'Century Gothic', 'Futura', sans-serif; margin: 0; font-size: 26px; letter-spacing: 1px; text-shadow: 2px 2px 3px rgba(255,255,255,0.7); position: relative; width: 100%; text-align: center; display: flex; justify-content: center; align-items: center;">
                                    @shopChanges.ShopName
                                </h2>
                            </div>
                        </div>

                        <!-- Content Container -->
                        <div style="padding: 0 15px 15px;">
                            @if (shopChanges.AddedItems.Count > 0)
                            {
                                <!-- Added Items Section -->
                                <div style="background-color: #E6F8E8; border: 2px solid #66B032; border-radius: 12px; margin-bottom: 18px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.08);">
                                    <div style="background-color: #66B032; color: white; font-family: 'Century Gothic', 'Futura', sans-serif; font-size: 18px; letter-spacing: 0.5px; padding: 10px; text-align: center; position: relative; overflow: hidden;">
                                        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;
                                                 background: linear-gradient(45deg, rgba(255,255,255,0.15) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.15) 50%, rgba(255,255,255,0.15) 75%, transparent 75%, transparent);
                                                 background-size: 20px 20px;"></div>
                                        <span style="position: relative;">@Model.NewItemsHeader</span>
                                    </div>
                                    <div style="padding: 12px;">
                                        @foreach (var item in shopChanges.AddedItems)
                                        {
                                            <a href="@item.Link" target="_blank" style="text-decoration: none; color: inherit;">
                                                <div style="background: linear-gradient(to bottom, white, #f8fff8); border-radius: 8px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); margin-bottom: 5px; overflow: hidden; padding: 15px; transition: all 0.2s ease; border-left: 4px solid #66B032; display: flex; align-items: center;">
                                                    <div style="flex: 1; display: flex; align-items: center;">
                                                        <span style="color: #66B032; font-size: 13px; margin-right: 5px;">●</span>
                                                        <span style="font-weight: bold; font-size: 16px; color: #43357A;">@item.Name</span>
                                                    </div>
                                                    <div style="display: flex; align-items: center; gap: 10px;">
                                                        <div style="color: #4A4A4A; font-weight: bold; font-size: 18px; margin-right: 10px;">@($"${item.Cost:0.00}")</div>
                                                        <div style="background: linear-gradient(to right, #66B032, #8dd061); border-radius: 20px; color: white; font-size: 14px; font-weight: bold; padding: 5px 12px; box-shadow: 0 2px 4px rgba(102, 176, 50, 0.3);">
                                                            Available
                                                        </div>
                                                    </div>
                                                </div>
                                            </a>
                                        }
                                    </div>
                                </div>
                            }
                            @if (shopChanges.ChangedItems.Any())
                            {
                                <!-- Changed Items Section -->
                                <div style="background-color: #E9E4F0; border: 2px solid #9678B6; border-radius: 12px; margin-bottom: 18px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.08);">
                                    <div style="background-color: #9678B6; color: white; font-family: 'Century Gothic', 'Futura', sans-serif; font-size: 18px; letter-spacing: 0.5px; padding: 10px; text-align: center; position: relative; overflow: hidden;">
                                        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;
                                                 background: linear-gradient(45deg, rgba(255,255,255,0.15) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.15) 50%, rgba(255,255,255,0.15) 75%, transparent 75%, transparent);
                                                 background-size: 20px 20px;"></div>
                                        <span style="position: relative;">@Model.ChangedItemsHeader</span>
                                    </div>
                                    <div style="padding: 12px;">
                                        @foreach (var change in shopChanges.ChangedItems)
                                        {
                                            <a href="@change.newState.Link" target="_blank" style="text-decoration: none; color: inherit;">
                                                <div style="background: linear-gradient(to bottom, white, #f3f0f9); border-radius: 8px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); margin-bottom: 10px; overflow: hidden; padding: 15px; border-left: 4px solid #9678B6; display: flex; align-items: center;">
                                                    <div style="flex: 1; display: flex; align-items: center;">
                                                        <span style="color: #9678B6; font-size: 13px; margin-right: 5px;">●</span>
                                                        <span style="font-weight: bold; font-size: 16px; color: #43357A;">@change.newState.Name</span>
                                                    </div>
                                                    <div style="display: flex; align-items: center; gap: 10px;">
                                                        <div style="color: #4A4A4A; font-weight: bold; font-size: 18px; margin-right: 10px;">@($"${change.newState.Cost:0.00}")</div>
                                                        <div style="display: flex; flex-direction: column; gap: 5px;">
                                                            @if (change.oldState.Status == ShopStatus.SoldOut && change.newState.Status == ShopStatus.Available)
                                                            {
                                                                <span style="background-color: #FEE6E6; border-radius: 20px; color: #BD2D28; font-size: 13px; font-weight: bold; padding: 4px 10px; text-decoration: line-through; display: inline-block; box-shadow: 0 1px 3px rgba(189, 45, 40, 0.2);">Sold Out</span>
                                                                <span style="background: linear-gradient(to right, #66B032, #8dd061); border-radius: 20px; color: white; font-size: 13px; font-weight: bold; padding: 4px 10px; display: inline-block; box-shadow: 0 2px 4px rgba(102, 176, 50, 0.3);">Available</span>
                                                            }
                                                            else if (change.oldState.Status == ShopStatus.Available && change.newState.Status == ShopStatus.SoldOut)
                                                            {
                                                                <span style="background-color: #E6F8E8; border-radius: 20px; color: #66B032; font-size: 13px; font-weight: bold; padding: 4px 10px; text-decoration: line-through; display: inline-block; box-shadow: 0 1px 3px rgba(102, 176, 50, 0.2);">Available</span>
                                                                <span style="background: linear-gradient(to right, #BD2D28, #e75048); border-radius: 20px; color: white; font-size: 13px; font-weight: bold; padding: 4px 10px; display: inline-block; box-shadow: 0 2px 4px rgba(189, 45, 40, 0.3);">Sold Out</span>
                                                            }
                                                        </div>
                                                    </div>
                                                </div>
                                            </a>
                                        }
                                    </div>
                                </div>
                            }
                            @if (shopChanges.RemovedItems.Any())
                            {
                                <!-- Removed Items Section -->
                                <div style="background-color: #FEE6E6; border: 2px solid #BD2D28; border-radius: 12px; margin-bottom: 10px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.08);">
                                    <div style="background-color: #BD2D28; color: white; font-family: 'Century Gothic', 'Futura', sans-serif; font-size: 18px; letter-spacing: 0.5px; padding: 10px; text-align: center; position: relative; overflow: hidden;">
                                        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;
                                                 background: linear-gradient(45deg, rgba(255,255,255,0.15) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.15) 50%, rgba(255,255,255,0.15) 75%, transparent 75%, transparent);
                                                 background-size: 20px 20px;"></div>
                                        <span style="position: relative;">@Model.RemovedItemsHeader</span>
                                    </div>
                                    <div style="padding: 12px;">
                                        @foreach (var item in shopChanges.RemovedItems)
                                        {
                                            <div style="background: linear-gradient(to bottom, white, #fff2f2); border-radius: 8px; box-shadow: 0 3px 10px rgba(0,0,0,0.1); margin-bottom: 5px; overflow: hidden; padding: 15px; border-left: 4px solid #BD2D28; display: flex; align-items: center;">
                                                <div style="flex: 1; display: flex; align-items: center;">
                                                    <span style="color: #BD2D28; font-size: 13px; margin-right: 5px;">●</span>
                                                    <span style="font-weight: bold; font-size: 16px; color: #43357A; text-decoration: line-through;">@item.Name</span>
                                                </div>
                                                <div style="display: flex; align-items: center; gap: 10px;">
                                                    <div style="color: #999; font-weight: bold; font-size: 18px; text-decoration: line-through; margin-right: 10px;">@($"${item.Cost:0.00}")</div>
                                                    <div style="background: linear-gradient(to right, #BD2D28, #e75048); border-radius: 20px; color: white; font-size: 14px; font-weight: bold; padding: 5px 12px; box-shadow: 0 2px 4px rgba(189, 45, 40, 0.3);">
                                                        Removed
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                </div>
                            }
                        </div>

                        <!-- Spacer between shops if not the last one -->
                        @if (shopChanges != Model.Changes.Last())
                        {
                            <div style="height: 2px; background: linear-gradient(to right, transparent, #CBC3E3, transparent); margin: 15px 40px 25px;"></div>
                        }
                    }

                    <!-- Footer -->
                    <div style="background: linear-gradient(135deg, #CBC3E3 0%, #FFC2D1 100%); padding: 20px; text-align: center; border-top: 5px solid white; position: relative; overflow: hidden;">
                        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;
                             background: radial-gradient(circle at 20% 50%, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 50%),
                                       radial-gradient(circle at 80% 50%, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 50%);"></div>
                        <p style="color: #43357A; font-size: 16px; margin: 0; position: relative; font-family: 'Century Gothic', 'Futura', sans-serif; font-weight: bold; text-shadow: 1px 1px 0px rgba(255,255,255,0.5);">
                            @Model.FooterMessage
                        </p>
                    </div>

                </div>
                <!-- End Main Container -->
            </td>
        </tr>
    </table>
</body>
</html>